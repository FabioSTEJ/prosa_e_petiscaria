{% extends "base_admin.html" %}

{% block content %}
<div class="container-admin">
    <h2>Gerenciar Equipe üë•</h2>

    <div class="card-form">
        <form method="POST">
            <div class="form-group">
                <label>Nome Completo (Para exibi√ß√£o):</label>
                <input type="text" name="nome_exibicao" placeholder="Ex: F√°bio Silva" required>
            </div>

            <div class="form-group">
                <label>Nome de Usu√°rio (Para Login):</label>
                <input type="text" name="username" placeholder="Ex: fabio_garcom" required>
            </div>

            <div class="form-group">
                <label>Senha de Acesso:</label>
                <input type="password" name="password" placeholder="Digite a senha" required>
            </div>
            
            <div class="form-group">
                <label>N√≠vel de Acesso:</label>
                <select name="cargo">
                    <option value="garcom">Gar√ßom</option>
                    <option value="admin">Administrador</option>
                </select>
            </div>
            
            <button type="submit" class="btn-success">Cadastrar Usu√°rio</button>
        </form>
    </div>

    <hr class="divisor">

    <h3>Equipe Cadastrada</h3>
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Nome / Login</th>
                    <th>Cargo</th>
                    <th>Status</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody>
                {% for u in usuarios %}
                <tr class="{{ 'row-inactive' if not u.ativo }}">
                    <td>
                        <span class="user-main-name">{{ u.nome_exibicao }}</span><br>
                        <small class="user-username">@{{ u.username }}</small>
                    </td>
                    <td>
                        <span class="badge {{ 'badge-admin' if u.cargo == 'admin' else 'badge-garcom' }}">
                            {{ u.cargo | capitalize }}
                        </span>
                    </td>
                    <td>
                        <span class="status-indicator {{ 'status-active' if u.ativo else 'status-inactive' }}">
                            ‚óè {{ 'Ativo' if u.ativo else 'Inativo' }}
                        </span>
                    </td>
                    <td>
                        <div class="acoes-botoes">
                            <a href="javascript:void(0)" 
                               onclick="resetarSenha('{{ u.id }}', '{{ u.username }}')" 
                               class="btn-action btn-edit" title="Resetar Senha">üîë</a>
                            
                            <a href="{{ url_for('admin.alternar_status_usuario', usuario_id=u.id) }}" 
                               class="btn-action {{ 'btn-warning' if u.ativo else 'btn-success-small' }}" 
                               title="{{ 'Desativar' if u.ativo else 'Ativar' }}">
                                {{ 'üö´' if u.ativo else '‚úÖ' }}
                            </a>

                            {% if u.username != session['username'] and u.username != 'adminprosa' %}
                                <a href="{{ url_for('admin.excluir_usuario', usuario_id=u.id) }}" 
                                   onclick="return confirm('Tem certeza que deseja excluir permanentemente este usu√°rio?')"
                                   class="btn-action btn-delete" title="Excluir Permanentemente">üóëÔ∏è</a>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function resetarSenha(userId, username) {
    const novaSenha = prompt("Digite a nova senha para @" + username + ":");
    if (novaSenha && novaSenha.length > 0) {
        // Cria um formul√°rio tempor√°rio para enviar o POST
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = "/admin/usuarios/senha/" + userId;

        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'nova_senha';
        input.value = novaSenha;

        form.appendChild(input);
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}